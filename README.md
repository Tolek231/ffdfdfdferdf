# Wandlead Sender

–ú–æ–¥—É–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ email-—Ä–∞—Å—Å—ã–ª–æ–∫ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π SendGrid, Telegram-–±–æ—Ç–æ–º –∏ –≤–µ–±-–¥–∞—à–±–æ—Ä–¥–æ–º.

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úâÔ∏è –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å–µ–º —á–µ—Ä–µ–∑ SendGrid API
- ü§ñ Telegram-–±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å—Å—ã–ª–∫–∞–º–∏
- üìä –í–µ–±-–¥–∞—à–±–æ—Ä–¥ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
- üîç –í–∞–ª–∏–¥–∞—Ü–∏—è email (DNS + Mailboxlayer)
- üìà –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–∏–π –∏ –æ—Ç–≤–µ—Ç–æ–≤
- üéØ –ú—É–ª—å—Ç–∏-—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å (—Ç–æ–∫–µ–Ω—ã –∫–∞–±–∏–Ω–µ—Ç–æ–≤)
- üö´ –ë–ª–æ–∫-–ª–∏—Å—Ç—ã –∏ —Ñ–∏–ª—å—Ç—Ä—ã
- üì• –ó–∞–≥—Ä—É–∑–∫–∞ CSV –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env –∏ —É–∫–∞–∂–∏—Ç–µ –≤–∞—à–∏ –∫–ª—é—á–∏

# –ó–∞–ø—É—Å–∫
npm start
```

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É –∏–∑ `PORT` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3000).

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã
- [QUICKSTART.md](QUICKSTART.md) ‚Äî –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∑–∞ 3 –º–∏–Ω—É—Ç—ã ‚ö°
- [MIGRATION_GUIDE.md](MIGRATION_GUIDE.md) ‚Äî —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏
- [CHECKLIST.md](CHECKLIST.md) ‚Äî —á–µ–∫–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- [ARCHITECTURE.md](ARCHITECTURE.md) ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- [PROJECT_STRUCTURE.md](PROJECT_STRUCTURE.md) ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤
- [TREE.txt](TREE.txt) ‚Äî –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –¥–µ—Ä–µ–≤–æ –ø—Ä–æ–µ–∫—Ç–∞

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- [CONTRIBUTING.md](CONTRIBUTING.md) ‚Äî –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- [docs/API.md](docs/API.md) ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ HTTP API
- [README_TOKENS.md](README_TOKENS.md) ‚Äî —Ä–∞–±–æ—Ç–∞ —Å —Ç–æ–∫–µ–Ω–∞–º–∏

### –≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è
- [OPERATIONS.md](OPERATIONS.md) ‚Äî –¥–µ–ø–ª–æ–π –∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è

### –ò—Å—Ç–æ—Ä–∏—è
- [CHANGELOG.md](CHANGELOG.md) ‚Äî —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [REFACTORING_SUMMARY.md](REFACTORING_SUMMARY.md) ‚Äî —Ä–µ–∑—é–º–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏!
- –†–µ–∞–ª—å–Ω—ã–µ ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ‚Äî –≤ Amvera –∏–ª–∏ Docker
- –õ–æ–∫–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.env` (–¥–æ–±–∞–≤–ª–µ–Ω –≤ .gitignore)

## Docker
–°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ:
```bash
docker build -t sender-app .
docker run --rm -p 3000:3000       -e SENDGRID_API_KEY=...       -e FROM_EMAIL=...       -e TELEGRAM_BOT_TOKEN=...       -e DATA_DIR=/data       -v $PWD/.local-data:/data       sender-app
```

–ü—Ä–æ–≤–µ—Ä–∫–∞:
```bash
curl http://localhost:3000/health
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ—Ä—Ç–æ–º 80 (EACCES)
–ï—Å–ª–∏ —Ö–æ—Å—Ç–∏–Ω–≥ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç `PORT=80/443`, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–æ–∂–µ—Ç –ø–∞–¥–∞—Ç—å —Å `EACCES`.
–í Dockerfile –¥–æ–±–∞–≤–ª–µ–Ω `setcap` –¥–ª1—è `/usr/local/bin/node`, –ø–æ—ç—Ç–æ–º—É –∑–∞–ø—É—Å–∫ –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º `node`
—Å–º–æ–∂–µ—Ç —Å–ª—É—à–∞—Ç—å 80/443 –±–µ–∑ root. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ ‚Äî –∑–∞–¥–∞—Ç—å `PORT=3000` –∏ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –Ω–µ–≥–æ.

### Amvera –∏ PORT=80
–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∑–∞–ø—É—Å–∫–∞—é—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å —Ñ–ª–∞–≥–æ–º `no-new-privileges`, –∏–∑-–∑–∞ —á–µ–≥–æ capability `CAP_NET_BIND_SERVICE`
(–¥–∞–∂–µ –µ—Å–ª–∏ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∞ —á–µ—Ä–µ–∑ `setcap`) –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è, –∏ –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –º–æ–∂–µ—Ç —Å–ª—É—à–∞—Ç—å 80/443 –∫–∞–∫ non-root. –î–ª—è —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞–µ–≤
Dockerfile –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –∑–∞–ø—É—Å–∫ –æ—Ç root, —á—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å `EACCES` –Ω–∞ 80. –ï—Å–ª–∏ –≤–∞—à–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –ø–æ–∑–≤–æ–ª–∏—Ç ‚Äî –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å
–∑–∞–ø—É—Å–∫ –ø–æ–¥ `node` –∏ `setcap` (—Å–º. –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≤–∞—Ä–∏–∞–Ω—Ç Dockerfile).

### –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π Dockerfile –¥–ª—è Amvera
–ò–∑-–∑–∞ –æ—à–∏–±–∫–∏ `/bin/sh: syntax error: unexpected "then" (expecting "fi")` —É –±–∏–ª–¥–µ—Ä–∞
—É–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π: —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
`RUN [ -f package-lock.json ] && npm ci --omit=dev || npm i --omit=dev` –±–µ–∑ `elif`.
–¢–∞–∫–∂–µ `EXPOSE 80` –¥–æ–±–∞–≤–ª–µ–Ω –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å PaaS.

## Docker –∑–∞–ø—É—Å–∫
```bash
docker build -t sender-app .
docker run --rm -p 80:80       -e PORT=80       -e DATA_DIR=/data       -e SENDGRID_API_KEY=...       -e FROM_EMAIL=...       -e TELEGRAM_BOT_TOKEN=...       -e TELEGRAM_ADMIN_IDS=123,456       -e BASE_URL=https://your-domain       -v $PWD/.local-data:/data       sender-app
curl -i http://localhost/health
```
